<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Gandhi Jayanti Card Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f7f8fa; margin: 0; }
    .main { max-width: 370px; margin: 36px auto; background: #fff; border-radius: 18px; box-shadow: 0 6px 28px #e3eaef; padding: 22px 16px 24px 16px; text-align: center; }
    h1 { font-size: 1.28rem; color: #138808; margin-bottom: 14px; }
    .step { font-size: 1.09rem; color: #0b3301; margin: 18px 0 7px 0; }
    button { width: 94%; margin: 8px 0; padding: 14px 0; font-size: 1.13rem; background: #138808; color: #fff; border-radius: 11px; font-weight: bold; border: none; cursor: pointer; }
    #photoPreview { width: 66px; height: 66px; border-radius: 50%; object-fit: cover; display: none; margin: 8px auto; box-shadow: 0 2px 9px #bbe9b1; }
    #quoteDisplay { font-size: 1.12rem; font-weight: 500; color: #222; min-height: 38px; margin: 10px 0 14px 0; }
    #downloadBtn { margin: 18px 0 0 0; }
    #msg { color: #138808; font-size: .97rem; margin: 8px 0; }
    .hidden { display: none; }
    .canvas-wrap { text-align: center; margin-top: 12px;}
    @media (max-width: 430px) {
      .main { max-width: 99vw; padding: 6vw 2vw; }
      h1 { font-size: 1.01rem; }
    }
  </style>
</head>
<body>
  <div class="main">
    <h1>Gandhi Jayanti Card Generator</h1>
    <div class="step">Step 1: Pick a Gandhi quote</div>
    <button onclick="chooseQuote()">üé≤ Show Gandhi Quote</button>
    <div id="quoteDisplay"></div>
    <div class="step">Step 2: Upload your photo</div>
    <button onclick="uploadPhoto()">Upload Photo</button>
    <button onclick="takePhoto()">Take Photo</button>
    <img id="photoPreview" src="" alt="Preview" />
    <div class="canvas-wrap" id="previewArea"></div>
    <button id="downloadBtn" class="hidden" onclick="downloadCard()">‚¨áÔ∏è Download & Share PNG</button>
    <div id="msg"></div>
  </div>
  <footer style="text-align:center;font-size:1rem;color:#444;margin:22px 0 12px 0;">For students ‚Ä¢ Gandhi Jayanti 2025 ‚Ä¢ MGC</footer>
  <canvas id="canvasExport" width="960" height="768" class="hidden"></canvas>
  
  <script>
    const templateFile = "White-Orange-and-Green-Illustrated-Gandhi-Jayanti-Instagram-Post-1.jpg";
    const quotes = [
      "Be the change you wish to see in the world.",
      "An eye for an eye will make the whole world blind.",
      "The future depends on what you do today.",
      "Live as if you were to die tomorrow. Learn as if you were to live forever.",
      "Happiness is when what you think, what you say, and what you do are in harmony.",
      "Strength does not come from physical capacity. It comes from an indomitable will.",
      "Peace is its own reward.",
      "The weak can never forgive. Forgiveness is the attribute of the strong.",
      "The best way to find yourself is to lose yourself in the service of others.",
      "Service without humility is selfishness and egotism.",
      "You may never know what results come of your actions, but if you do nothing, there will be no result.",
      "First they ignore you, then they laugh at you, then they fight you, then you win.",
      "Freedom is not worth having if it does not include the freedom to make mistakes.",
      "The greatness of humanity is not in being human, but in being humane.",
      "You must not lose faith in humanity. Humanity is an ocean; if a few drops of the ocean are dirty, the ocean does not become dirty.",
      "Earth provides enough to satisfy every man‚Äôs needs, but not every man‚Äôs greed.",
      "Live simply so that others may simply live.",
      "In a gentle way, you can shake the world.",
      "Nonviolence is the greatest force at the disposal of mankind.",
      "There is no path to peace. Peace is the path.",
      "My life is my message.",
      "Satisfaction lies in the effort, not in the attainment. Full effort is full victory.",
      "The good man is the friend of all living things.",
      "A man is but the product of his thoughts. What he thinks, he becomes.",
      "To call woman the weaker sex is a libel; it is man‚Äôs injustice to woman.",
      "Champions are made from something they have deep inside them‚Äîa desire, a dream, a vision.",
      "Non-cooperation with evil is as much a duty as cooperation with good.",
      "Glory lies in the attempt to reach one‚Äôs goal and not in reaching it.",
      "Our greatness lies not so much in being able to remake the world as in being able to remake ourselves.",
      "Man becomes great exactly in the degree in which he works for the welfare of his fellow men.",
      "Truth never damages a cause that is just.",
      "Faith is not something to grasp, it is a state to grow into.",
      "Prayer is not asking. It is a longing of the soul.",
      "Nobody can hurt me without my permission.",
      "The difference between what we do and what we are capable of doing would suffice to solve most of the world‚Äôs problems.",
      "Non-violence requires a double faith, faith in God and also faith in man.",
      "Power is of two kinds. One is obtained by the fear of punishment and the other by acts of love.",
      "You don‚Äôt know who is important to you until you actually lose them.",
      "The essence of all religions is one. Only their approaches are different."
    ];

    let selectedQuote = "", userPhoto = "";

    // Image loader helper
    function loadImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = src;
      });
    }

    function chooseQuote() {
      selectedQuote = quotes[Math.floor(Math.random() * quotes.length)];
      document.getElementById("quoteDisplay").innerText = selectedQuote;
      renderPreview();
    }

    function uploadPhoto() {
      let inp = document.createElement("input");
      inp.type = "file";
      inp.accept = "image/*";
      inp.onchange = (e) => handlePhoto(e);
      inp.click();
    }

    function takePhoto() {
      let inp = document.createElement("input");
      inp.type = "file";
      inp.accept = "image/*";
      inp.capture = "environment";
      inp.onchange = (e) => handlePhoto(e);
      inp.click();
    }

    function handlePhoto(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        userPhoto = e.target.result;
        let img = document.getElementById("photoPreview");
        img.src = userPhoto;
        img.style.display = "block";
        renderPreview();
      };
      reader.readAsDataURL(file);
    }

    // ==== FIXED PREVIEW ====
    function renderPreview() {
      const area = document.getElementById("previewArea");
      area.innerHTML = "";
      let show = !!selectedQuote;
      document.getElementById("downloadBtn").classList.toggle("hidden", !show);
      if (!show) return;

      let previewC = document.createElement("canvas");
      previewC.width = 320;
      previewC.height = 256;
      let ctx = previewC.getContext("2d");

      let promises = [loadImage(templateFile)];
      if (userPhoto) promises.push(loadImage(userPhoto));

      Promise.all(promises).then(images => {
        const bgImg = images[0];
        ctx.clearRect(0, 0, previewC.width, previewC.height);
        ctx.drawImage(bgImg, 0, 0, 320, 256);

        if (userPhoto) {
          const photo = images[1];
          ctx.save();
          ctx.beginPath();
          ctx.arc(280, 32, 19, 0, 2 * Math.PI);
          ctx.closePath();
          ctx.clip();
          ctx.drawImage(photo, 261, 13, 38, 38);
          ctx.restore();
        }

        ctx.save();
        ctx.font = "bold 15px Segoe UI";
        ctx.fillStyle = "#1e1e1e";
        wrapText(ctx, selectedQuote, 40, 78, 250, 18);
        ctx.restore();
      });

      area.appendChild(previewC);
    }

    // ==== FIXED DOWNLOAD ====
    function downloadCard() {
      const canvas = document.getElementById("canvasExport");
      const ctx = canvas.getContext("2d");

      let promises = [loadImage(templateFile)];
      if (userPhoto) promises.push(loadImage(userPhoto));

      Promise.all(promises).then(images => {
        const bgImg = images[0];
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(bgImg, 0, 0, 960, 768);

        if (userPhoto) {
          const photo = images[1];
          ctx.save();
          ctx.beginPath();
          ctx.arc(845, 98, 35, 0, 2 * Math.PI);
          ctx.closePath();
          ctx.clip();
          ctx.drawImage(photo, 810, 63, 70, 70);
          ctx.restore();
        }

        // ‚úÖ Always draw quote
        ctx.save();
        ctx.font = "bold 30px Segoe UI";
        ctx.fillStyle = "#222";
        wrapText(ctx, selectedQuote, 170, 182, 620, 34);
        ctx.restore();

        // Download
        let link = document.createElement("a");
        link.download = "GandhiJayanti_Card.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
        document.getElementById("msg").innerText = "Downloaded! Share on Instagram & WhatsApp!";
      });
    }

    // Text wrapping helper
    function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
      const words = text.split(" ");
      let line = "", yy = y;
      for(let n = 0; n < words.length; n++) {
        let testLine = line + words[n] + " ";
        if(ctx.measureText(testLine).width > maxWidth && n > 0) {
          ctx.fillText(line, x, yy);
          line = words[n] + " ";
          yy += lineHeight;
        } else {
          line = testLine;
        }
      }
      ctx.fillText(line, x, yy);
    }

    renderPreview();
  </script>
</body>
</html>
